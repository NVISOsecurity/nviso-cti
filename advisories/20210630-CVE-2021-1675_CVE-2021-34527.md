## NVISO CSIRT ADVISORY
**UPDATE #5 2021-08-10** - Microsoft has released a fix to PrintNightmare in the August 2021 Patch Tuesday release. "Microsoft has fixed the PrintNightmare vulnerability in the Windows Print Spooler by requiring users to have administrative privileges when using the Point and Print feature to install printer drivers." - source https://www.bleepingcomputer.com/news/microsoft/microsoft-fixes-windows-print-spooler-printnightmare-vulnerability/

Microsoft KB article that helps organization that need print drivers to be installed by non-admin level users: https://support.microsoft.com/en-us/topic/kb5005652-manage-new-point-and-print-default-driver-installation-behavior-cve-2021-34481-873642bf-2634-49c5-a23b-6d8e9a302872

**UPDATE #4 2021-07-16** - Microsoft has assigned a third CVE for PrintNightmare. This one is for the local priveledge escalation bug that was discovered after the RCE patches (CVE-2021-34527) at the start of July, you have to be able to execute code on the system to expolit this vulnerability. The advisory includes only workarounds for now. No actual patches out. https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34481

**UPDATE #3 2021-07-09** - Microsoft has released a blog post to give clarity to the confusion generated by the PrintNightmare related vulnerabilities. Microsoft stated "Our investigation has shown that the OOB security update is working as designed and is effective against the known printer spooling exploits and other public reports collectively being referred to as PrintNightmare. All reports we have investigated have relied on the changing of default registry setting related to Point and Print to an insecure configuration." Please read and follow the guidance located here: https://msrc-blog.microsoft.com/2021/07/08/clarified-guidance-for-cve-2021-34527-windows-print-spooler-vulnerability/

**UPDATE #2 2021-07-07** - Researchers have confirmed that if you have Point and Click enabled then the emergency patch released by Microsoft does not fix the vulnerability. Drivers can be remotely added using this functionality. There is a current Mimikatz implementation that can add drivers, signed or unsigned, which could fully exploit the vulnerability. Organization should also restrict printer driver installation privileges. See the FAQ section of the updated Microsoft Security Update Guide.

**UPDATE 2021-07-07** - Microsoft has released an emergency out-of-band patch for CVE-2021-34527. This update only fixes the remote code execution variants of PrintNightmare, it does not fix the local privilege escalation issue. Mitigations are still needed for to stop local privilege escalation. They have been updated and are listed here: https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527.

**UPDATE 2021-07-02** – Microsoft has issued more guidance for this vulnerability as well as a new CVE number: CVE-2021-34527. The CVE is currently unscored as it is still in the research process. Please follow the recommendations previously listed and patch as soon as a fix is available. Additional information on the new CVE can be found at Microsoft's Security Update Guide: https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527.


**UPDATE 2021-07-01** – Further analysis of the PoC code leaked showed that the Print Spooler service can still be abused even after the Microsoft patch has been applied. The original authors have also released a statement that they will release more information on additional vulnerabilities in the Print Spooler service at the Black Hat security conference. Please refer to the Available Workarounds section for the best actions to take now. Patch this vulnerability as soon as a new patch is available. New updates to this advisory will be made available on our Github page: https://github.com/NVISOsecurity/nviso-cti/blob/master/advisories/20210630-CVE-2021-1675_CVE-2021-34527.md, please check for updates frequently.


**2021-06-30**
## SUMMARY
As part of the June 2021 Patch Tuesday, Microsoft released a patch for CVE-2021-1675. This patch fixed a vulnerability in the Windows Print Spooler service which would allow a user to perform Local Privilege Escalation. Recently, Proof of Concept (PoC) code has been released that confirms this vulnerability can also be abused in a Remote Code Execution (RCE) attack. 

## WHY THIS MATTERS
This vulnerability allows for full remote code execution on the target system, additionally, this vulnerability can also be used without authentication in order to attempt local privilege escalation. Following the proof of concept code being leaked, it is expected to see widespread attacks happening soon. This vulnerability is likely to be used in the second stage of an attack to spread laterally or to gain domain admin privileges. However, if the Print Spooler service is exposed to the internet it could also be used as an initial infection vector. 

## AFFECTED PRODUCTS
All Windows OS versions

## AVAILABLE WORKAROUNDS
Disable the print spooler service on all machines or disable the service on machines that have elevated privileges such as Domain Controllers and other administrative systems. Note that printer pruning will not be functional after disabling this service, however, this functionality is rarely used. 
https://docs.microsoft.com/en-us/defender-for-identity/cas-isp-print-spooler 
** Update 2021-07-01 ** - https://us-cert.cisa.gov/ncas/current-activity/2021/06/30/printnightmare-critical-windows-print-spooler-vulnerability

## AVAILABLE PATCHES
It is recommended to apply or install the available patches as soon as possible:
https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2021-1675

## CVSS SCORE AND CVE ID
|CVE ID	|Severity	|CVSSv2 Score	|CVSSv3 Score	|Patching Timeframe|
|-------|---------|-------------|-------------|------------------|
|CVE-2021-01675	|High	|6.8	|7.8	|5 days|

Note: this vulnerability is also known as PrintNightmare.

NIST: http://nvd.nist.gov/vuln/detail/CVE-2021-1675 

MITRE: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-1675 

## RECOMMENDED ACTIONS
High risk vulnerabilities are strongly advised to be patched within 5 days of this notice. Due to the release of additional exploit proof of concept code we believe this should be patched as soon as possible due to the increased risk.

As this vulnerability could also be abused to gain initial access into the network, it is advised to ensure any device running the print spooler service is not exposed to the internet.

Additionally, a SIGMA rule was released to monitor for exploitation. This can be further modified to work in additional SIEMs and track unauthorized driver updates. 
https://github.com/SigmaHQ/sigma/pull/1588/files 

## CONTACT AND FEEDBACK
Our goal is to provide a fast, brief, and actionable advisory on critical cyber security incidents.
Was this advisory of value to your organization? Was the content clear and concise? Your comments and feedback are very important to us. 
Please do not hesitate to reach out to csirt@nviso.eu   

 
